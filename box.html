<html>
<head>
<link rel="stylesheet" href="css/style.css">
<script lang="javascript" src="js/fxn.js"></script>
<script lang="javascript" src="js/pkmn-names.js"></script>
<script lang="javascript" src="poke_icon/g01/box-g01.js"></script>
<script lang="javascript" src="poke_icon/g02/box-g02.js"></script>
<script lang="javascript" src="poke_icon/g08/box-g08.js"></script>
<script lang="javascript" src="js/game.js"></script>
</head>
<body>
<script lang="javascript">
boxCntr = 1;
boxIdx = 1;
boxHead = "";
boxBody = "";
gameName = getQueryVariable("game");
_Dex = _GameVersions[gameName];
if (_Dex == undefined)
{
	document.writeln("Unknown game: ", gameName);
	die();
}

version = getQueryVariable("ver");

console.log(_Dex);

game = _Dex.id;
_Rdex = _Dex.rDex;
_Ndex = _Dex.nDex;
_Edex = _Dex.eDex;
iconPath = _Dex.icoPath;
imgWd = _Dex.imgWd;
maxBox = _Dex.maxBox;
divBox = _Dex.divBox;

var savedZukan = localStorage.getObject(lsName);
if (savedZukan == null)
	savedZukan = {};
var savedZukanGame = [];
if (savedZukan.indexOf)
	savedZukanGame = savedZukan[game];

Object.entries(_GameVersions).forEach(gv =>
 {
	if (gv[1].id === -1)
		return;

	document.write(`[&nbsp;<a href='box.html?game=${gv[1].code}&ver=${version}'>${gv[1].name}</a>&nbsp;]`);
});

// if (game == GameVersion._Sw || game == GameVersion._Sh)
// {
// 	_Rdex = _Regdex_SwSh;
// 	_Ndex = _Natdex_G08;
// 	_Edex = _Evodex_G08;
// 	iconPath = _IcoPath_Home;
// 	if (version == "r")	// Evolution Dex
// 	{
// 		iconPath = _IcoPath_SwSh;
// 	}
// }

if (version == "e")	// Evolution Dex
{
	_Ndex = _Edex;
}
else if (version == "r") // Regional Dex
{
	_Ndex = _Rdex;
}

_MaxDex = Object.keys(_Ndex).length;

boxCntr = 1;
boxIdx = 1;
boxHead = "";
boxBody = "";
boxFoot = "";
key = 0;
idxStr = "0000";
keyStr = "";
for (const rdex in _Ndex)
{
	if (rdex.substring(0, 4) != idxStr)
	{
		++key;
		idxStr = rdex.substring(0, 4);
	}
	if (game < _GameVersions.Ru.id) // Gen 1 & 2
	{
		keyStr = String(key).padStart(3, "0");
	}
	else
	{
		keyStr = String(key).padStart(4, "0");
	}
	if (boxCntr == 1)
	{
		boxHead = `<table style='border:1px solid gray; font-family:consolas; text-align:center;' cellspacing=0>`;
		boxHead += `<tr><th colspan=${divBox} style='border:1px solid gray;'>${gameName} ${String(boxIdx).padStart(2, "0")}`;
		if (version == "e")
		{
			boxHead += " E";
		}
		else if (version == "r")
		{
			boxHead += " R";
		}
		else
		{
			boxHead += " N";
		}
		boxHead += keyStr;
		++boxIdx;
	}

	console.log(typeof(rdex) + " " + rdex + ": " + _Names[rdex]);
	if (version == "e")
	{
		boxBody += `<td style='border:1px solid gray; width:50px; vertical-align:top;'>`;
		boxBody += `<span title='${rdex.substr(0, 4)} ${_Names[rdex]}'>`;
		boxBody += `<img id='${idxStr}' src='${iconPath}${_Ndex[rdex]}.png' alt='${_Ndex[rdex]}' width='${imgWd}' `;
		if (savedZukanGame.indexOf(rdex) == -1)
			boxBody += `class="gray" `;
		boxBody += `onclick='imgPokemon_Clicked(this, ${game})'/>`;
		boxBody += `</span><br/>`;
		boxBody += `<span style='font-size:10px;'>#${rdex.substr(0, 4)}<br/>`;
		boxBody += `${_Names[rdex]}</span></td>`;
	}
	else
	{
		boxBody += `<td style='border:1px solid gray; width:50px; vertical-align:top;'>`;
		boxBody += `<span title='${keyStr} ${_Names[rdex]}'>`;
		boxBody += `<img id='${idxStr}' src='${iconPath}${_Ndex[rdex]}.png' alt='${_Ndex[rdex]}' width='${imgWd}' `;
		if (savedZukanGame.indexOf(rdex) == -1)
			boxBody += `class="gray" `;
		boxBody += `onclick='imgPokemon_Clicked(this, ${game})'/>`;
		boxBody += `</span><br/><span style='font-size:10px;'>#${keyStr}<br/>${_Names[rdex]}</span></td>`;
	}

	if (boxCntr == maxBox)
	{
		boxHead += `-${keyStr}</th></tr><tr>`;

		document.write(boxHead);
		document.write(boxBody);
		document.write("</tr></table><br/>");
		boxCntr = 0;
		boxHead = "";
		boxBody = "";
	}

	if (boxCntr % divBox == 0)
		boxBody += "</tr><tr>";

	boxCntr++;
}

// filler
while (boxCntr <= maxBox)
{
	boxBody += `<td style='border:1px solid gray; width:50px; vertical-align:top;'><img src='${iconPath}`;
	if (game < GameVersion._Ru) // Gen 1 & 2
	{
		boxBody += "00";
	}
	else
	{
		boxBody += "0000";
	}
	boxBody += `-none.png' width='${imgWd}px'/>`;
	// boxBody += `-none.png' width='${imgWd}px' `;
	// if (savedZukanGame.indexOf(rdex) == -1)
	// 	boxBody += `class="gray" `;
	// boxBody += `onclick='imgPokemon_Clicked(this, ${game})'/>`;
	boxBody += `<span style='font-size:10px;'>&nbsp;</span></td>`;
	if (boxCntr % divBox == 0)
		boxBody += "</tr><tr>";
	boxCntr++;
}
boxHead += "-";
if (game < GameVersion._Ru) // Gen 1 & 2
{
	keyStr = String(key).padStart(3, "0");
}
else
{
	keyStr = String(key).padStart(4, "0");
}
boxHead += `${keyStr}</th></tr><tr>`;

document.write(boxHead);
document.write(boxBody);
document.write("</tr></table><br/>");
</script>

</body>
</html>